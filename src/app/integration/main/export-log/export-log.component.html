<div class="configuration-main--bg">
</div>
<div *ngIf="!isLoading" class="export-log">
  <div class="export-log--content">
    <!-- header -->
    <div *ngIf="totalCount" class="export-log--header-section">
      <div fxLayout="row" class="export-log--simple-search">
        <app-simple-search-select [form]="exportLogForm" [placeholder]="'Search by Employee Name or Expense ID'" [showBackgroundColor]="false"></app-simple-search-select>

        <!-- TODO: fix date filter -->
        <app-simple-search-select [form]="exportLogForm" [placeholder]="'Select date range'" [showBackgroundColor]="false"></app-simple-search-select>
      </div>
    </div>
    <!-- header -->

    <div class="export-log--table">
      <table *ngIf="totalCount" mat-table [dataSource]="expenseGroups">
        <ng-container matColumnDef="exportedAt">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Date and Time of Export</h4>
          </th>
          <td [ngClass]="{'pointer': element.fyleReferenceType !== FyleReferenceType.EXPENSE}" (click)="openChildExpenses(element.expenseGroupID)" mat-cell *matCellDef="let element">
            <h4>
              {{element.exportedAt | date: 'dd MMM, yyyy' }}
            </h4>

            <h5 class="export-log--sub-row">
              {{element.exportedAt | date: 'hh:mm' }}
            </h5>
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Employee Name and ID</h4>
          </th>
          <td [ngClass]="{'pointer': element.fyleReferenceType !== FyleReferenceType.EXPENSE}" (click)="openChildExpenses(element.expenseGroupID)" mat-cell *matCellDef="let element">
            <h4>
              {{ element.employee[0] }}
            </h4>
            <h5 class="export-log--sub-row">
              {{ element.employee[1] }}
            </h5>
          </td>
        </ng-container>

        <ng-container matColumnDef="fundSource">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Expense Type</h4>
          </th>
          <td [ngClass]="{'pointer': element.fyleReferenceType !== FyleReferenceType.EXPENSE}" (click)="openChildExpenses(element.expenseGroupID)" mat-cell *matCellDef="let element"> {{ element.expenseType }} </td>
        </ng-container>

        <ng-container matColumnDef="referenceID">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Reference ID</h4>
          </th>
          <td class="export-log--reference-id pointer" [matTooltip]="'View in Fyle'" mat-cell *matCellDef="let element" (click)="openExternalLink(element.fyleUrl)"> {{element.referenceNumber}} </td>
        </ng-container>

        <ng-container matColumnDef="exportType">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Exported to QBO as</h4>
          </th>
          <td [ngClass]="{'pointer': element.fyleReferenceType !== FyleReferenceType.EXPENSE}" (click)="openChildExpenses(element.expenseGroupID)" mat-cell *matCellDef="let element"> {{ element.exportedAs | titlecase }} </td>
        </ng-container>

        <ng-container matColumnDef="link">
          <th mat-header-cell *matHeaderCellDef>
            <h4>Link to QBO</h4>
          </th>
          <td mat-cell *matCellDef="let element" class="export-log--open-in-qbo">
            <img class="pointer" src="assets/images/svgs/actions/open-in-new-tab.svg" (click)="openExternalLink(element.qboUrl)"/>
          </td>
        </ng-container>

        <tr class="export-log--heading" mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr class="export-log--row" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Zero state -->
      <div *ngIf="!expenseGroups.filteredData.length" fxLayout="column" fxLayoutAlign="center center">
        <img class="export-log--zero-state-img" src="assets/images/pngs/zero-state/export-log.png">
        <h4 class="export-log--zero-state-text align-center">
          {{ exportLogForm.value.searchOption && !expenseGroups.filteredData.length ? 'Sorry, no results found!' : 'No records to show yet!' }}
        </h4>
        <h5 class="export-log--zero-state-text-small align-center">
          {{ exportLogForm.value.searchOption && !expenseGroups.filteredData.length ? 'Looks like your search term does not match any Employee Name or Expense ID' : 'All your successful exports and their details will be stored here.' }}
        </h5>

        <!-- TODO: update after adding date filter -->
        <h5 *ngIf="false" class="export-log--zero-state-text-small align-center">
          We could not find any exports done on timeline that you have selected
        </h5>
      </div>
      <!-- Zero state -->
    </div>

    <app-paginator *ngIf="expenseGroups.filteredData.length" [totalCount]="totalCount" [limit]="limit" [offset]="offset" (pageChangeEvent)="getExpenseGroups($event)"></app-paginator>
  </div>
</div>
