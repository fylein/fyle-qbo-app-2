<div class="dashboard" *ngIf="!isLoading">
  <!-- TODO -->
  <app-dashboard-header-section [name]="'Ashwin'"></app-dashboard-header-section>

  <div class="export">
    <div class="export--core-section">
      <div class="export--content-section">
        <div fxLayout="row" fxLayoutAlign="space-between center">
          <div fxLayout="row" fxLayoutAlign="space-between start">
            <div *ngIf="!exportInProgress && exportableExpenseGroupIds.length" class="export--arrow-section">
              <img src="assets/images/svgs/actions/arrow-up.svg" />
            </div>
            <div class="export--info-section">
              <h3 *ngIf="!exportInProgress && !exportableExpenseGroupIds.length">Sit back and relax!</h3>
              <h3 *ngIf="!exportInProgress && exportableExpenseGroupIds.length && !failedExpenseGroupCount">{{ exportableExpenseGroupIds.length }} new expenses ready to export</h3>
              <h3 *ngIf="exportInProgress">Exporting {{ processedCount }} of {{ exportableExpenseGroupIds.length }} expenses to your QBO account</h3>
              <h3 *ngIf="!exportInProgress && failedExpenseGroupCount">{{ failedExpenseGroupCount }} expenses to export</h3>
              <div class="export--info-text">
                <h5 *ngIf="!exportInProgress && !exportableExpenseGroupIds.length">No new expenses to export from the payment processing state in Fyle.</h5>
                <h5 *ngIf="!exportInProgress && !exportableExpenseGroupIds.length">Once you start processing payment for the expenses, they will be automatically available here to export.</h5>
                <h5 *ngIf="!exportInProgress && exportableExpenseGroupIds.length">Click on <b>Export</b> to start exporting these expenses from Fyle to Quickbooks Online.</h5>
                <h5 *ngIf="exportInProgress">This may take a few minutes. Please wait...</h5>
                <div fxLayout="row">
                  <h5 *ngIf="!exportInProgress && failedExpenseGroupCount">0 new expenses, {{ failedExpenseGroupCount }} previously failed expenses </h5>
                  <img *ngIf="!exportInProgress && failedExpenseGroupCount" src="assets/images/svgs/general/info.svg" class="export--info-icon" width="16px" height="16px" />
                </div>
              </div>
            </div>
          </div>
          <div fxLayout="row" class="pointer" class="configuration--submit-btn" [ngClass]="!exportableExpenseGroupIds.length || exportInProgress ? 'btn-disabled' : 'btn-enabled'" (click)="export()">
            <h5 class="single-line-text" class="configuration--submit-btn-text">
              Export
            </h5>
            <img src="assets/images/svgs/actions/arrow-mark-right.svg" class="configuration--submit-btn-arrow-text" />
          </div>
        </div>
      </div>
      <mat-progress-bar *ngIf="exportInProgress" mode="determinate" [value]="exportProgressPercentage"></mat-progress-bar>
    </div>
  </div>

  <div fxLayout="row" fxLayoutAlign="start start">
    <div class="past-export" *ngIf="pastExport">
      <div class="past-export--section">
        <div class="past-export--content-section">
          <h2 class="past-export--header">
            Your last export
          </h2>
          <p class="past-export--header-divider"></p>
          <div fxLayout="row" fxLayoutAlign="start center" class="past-export--row sub-text-color">
            <p class="past-export--detail">Date & Time of export</p>
            <p class="single-line-text">{{ pastExport.exported_at | date: 'dd MMM, yyyy' }} at {{ pastExport.exported_at | date: 'HH:mm' }}</p>
          </div>
          <p class="past-export--divider"></p>

          <div fxLayout="row" fxLayoutAlign="start center" class="past-export--row sub-text-color">
            <p class="past-export--detail">Mode of export</p>
            <p>{{ pastExport.mode }}</p>
          </div>
          <p class="past-export--divider"></p>

          <div fxLayout="row" fxLayoutAlign="start center" class="past-export--row sub-text-color">
            <p class="past-export--detail">Total expenses</p>
            <p>{{ pastExport.total_expenses }}</p>
          </div>
          <p class="past-export--divider"></p>

          <div fxLayout="row" fxLayoutAlign="start center" class="past-export--row sub-text-color">
            <p class="past-export--detail">Successful Expenses</p>
            <p class="past-export--view-expense">{{ pastExport.successful_expenses }}</p>
            <p class="past-export--view-expense-text pointer">View</p>
          </div>
          <p class="past-export--divider"></p>

          <div fxLayout="row" fxLayoutAlign="start center" class="past-export--row sub-text-color">
            <p class="past-export--detail">Failed Expenses</p>
            <p class="past-export--view-expense">{{ pastExport.failed_expenses }}</p>
            <p class="past-export--view-expense-text pointer">View</p>
          </div>
        </div>
      </div>
    </div>

    <div class="errors">
      <div class="errors--section" [ngClass]="{'errors--zero-state-section': !errors.EMPLOYEE_MAPPING.length && !errors.CATEGORY_MAPPING.length && !errors.QBO_ERROR.length}">
        <p class="errors--header" fxLayout="row">
          Errors
          <img src="assets/images/svgs/general/info.svg" class="errors--info-icon" width="16px" height="16px" matTooltip="Expenses failed to export due to the following errors. Resolve them before trying to re-export again." matTooltipPosition="right" />
        </p>
        <p class="errors--header-divider"></p>

        <div *ngIf="errors.EMPLOYEE_MAPPING.length || (groupedErrorStat && groupedErrorStat.EMPLOYEE_MAPPING) || errors.CATEGORY_MAPPING.length || (groupedErrorStat && groupedErrorStat.CATEGORY_MAPPING)" class="errors--integration-error-section">
          <div class="errors--integration-error-contents">
            <p>Integration Errors</p>
            <h5 class="errors--integration-error-sub-header sub-text-color">Check and resolve these errors before trying to re-export them again.</h5>
          </div>
        </div>

        <div *ngIf="errors.EMPLOYEE_MAPPING.length || (groupedErrorStat && groupedErrorStat.EMPLOYEE_MAPPING) || errors.CATEGORY_MAPPING.length || (groupedErrorStat && groupedErrorStat.CATEGORY_MAPPING)" class="errors--mapping-error-section">
          <div *ngIf="errors.EMPLOYEE_MAPPING.length || (groupedErrorStat && groupedErrorStat.EMPLOYEE_MAPPING)" class="errors--mapping-error-contents" fxLayout="row" fxLayoutAlign="space-between center">
            <div>
              <p>Employee Mapping errors</p>
              <h5 *ngIf="groupedErrorStat.EMPLOYEE_MAPPING" class="errors--resolved-stat sub-text-color">{{ groupedErrorStat.EMPLOYEE_MAPPING.resolvedCount }}/{{ groupedErrorStat.EMPLOYEE_MAPPING.totalCount }} error(s) resolved</h5>
            </div>
            <div *ngIf="!groupedErrorStat.EMPLOYEE_MAPPING || (groupedErrorStat.EMPLOYEE_MAPPING && groupedErrorStat.EMPLOYEE_MAPPING.resolvedCount !== groupedErrorStat.EMPLOYEE_MAPPING.totalCount)" fxLayout="row" class="errors--resolve-btn configuration--submit-btn pointer" (click)="resolveMappingError(errors.EMPLOYEE_MAPPING)">
              <p class="single-line-text configuration--save-btn-text">
                Resolve
              </p>
            </div>

            <div *ngIf="groupedErrorStat.EMPLOYEE_MAPPING && groupedErrorStat.EMPLOYEE_MAPPING.resolvedCount === groupedErrorStat.EMPLOYEE_MAPPING.totalCount" fxLayout="row">
              <img src="assets/images/svgs/general/tick-resolved.svg" class="errors--resolved-icon" width="16px" height="16px" />
              <p class="errors--resolve-btn-text sub-text-color single-line-text">
                Resolved
              </p>
            </div>
          </div>
          <p class="errors--divider"></p>

          <div *ngIf="errors.CATEGORY_MAPPING.length || (groupedErrorStat && groupedErrorStat.CATEGORY_MAPPING)" class="errors--mapping-error-contents" fxLayout="row" fxLayoutAlign="space-between center">
            <div>
              <p>Category Mapping errors</p>
              <h5 *ngIf="groupedErrorStat.CATEGORY_MAPPING" class="errors--resolved-stat sub-text-color">{{ groupedErrorStat.CATEGORY_MAPPING.resolvedCount }}/{{ groupedErrorStat.CATEGORY_MAPPING.totalCount }} error(s) resolved</h5>
            </div>
            <div *ngIf="!groupedErrorStat.CATEGORY_MAPPING || (groupedErrorStat.CATEGORY_MAPPING && groupedErrorStat.CATEGORY_MAPPING.resolvedCount !== groupedErrorStat.CATEGORY_MAPPING.totalCount)" fxLayout="row" class="errors--resolve-btn configuration--submit-btn pointer" (click)="resolveMappingError(errors.CATEGORY_MAPPING)">
              <p class="single-line-text configuration--save-btn-text">
                Resolve
              </p>
            </div>

            <div *ngIf="groupedErrorStat.CATEGORY_MAPPING && groupedErrorStat.CATEGORY_MAPPING.resolvedCount === groupedErrorStat.CATEGORY_MAPPING.totalCount" fxLayout="row">
              <img src="assets/images/svgs/general/tick-resolved.svg" class="errors--resolved-icon" width="16px" height="16px" />
              <p class="errors--resolve-btn-text sub-text-color single-line-text">
                Resolved
              </p>
            </div>
          </div>
          <p class="errors--divider"></p>
        </div>

        <div *ngIf="errors.QBO_ERROR.length" class="errors--integration-error-section">
          <div class="errors--integration-error-contents">
            <p>Quickbooks Errors</p>
            <h5 class="errors--integration-error-sub-header sub-text-color">Resolve these errors on your Quickbooks Account before trying to re-export them again.</h5>
          </div>
        </div>

        <div *ngFor="let error of errors.QBO_ERROR">
          <div fxLayout="row" fxLayoutAlign="space-between center" class="errors--qbo-error">
            <div>
              <p>{{ error.error_title }}</p>
              <h5 class="errors--qbo-error-short-description sub-text-color">{{ error.error_detail }}</h5>
            </div>
            <div class="errors--view-expenses pointer">
              <h5 class="errors--view-expenses-text">View Expenses</h5>
            </div>
          </div>
        </div>

        <app-zero-state-with-illustration *ngIf="!errors.EMPLOYEE_MAPPING.length && !errors.CATEGORY_MAPPING.length && !errors.QBO_ERROR.length && !groupedErrorStat.EMPLOYEE_MAPPING && !groupedErrorStat.CATEGORY_MAPPING" [page]="'dashboard_error'"></app-zero-state-with-illustration>
      </div>
    </div>
  </div>

  <app-zero-state-with-illustration *ngIf="zeroState" [page]="'dashboard'"></app-zero-state-with-illustration>
</div>

